import{R as n,a as _,L as u,S as B,t as g,A as G,j as e,G as C,o as q,p as T,E as z,c as L,q as J,r as P}from"./index-CggZzSzW.js";import{a as V,b as H,g as K,G as R,d as U}from"./gistapi-yzwnXLYQ.js";const W="https://github.com/settings/tokens/new?scopes=gist&description=https://lrc-maker.github.io",F={autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",spellCheck:!1},Y=({lrcDispatch:p,langName:k})=>{const{lang:i,trimOptions:h}=n.useContext(_),[m,j]=n.useState(()=>localStorage.getItem(u.token)),[l,x]=n.useState(()=>localStorage.getItem(u.gistId)),[f,v]=n.useState(void 0),[o,O]=n.useState(()=>JSON.parse(localStorage.getItem(u.gistFile))),d=n.useMemo(()=>JSON.parse(sessionStorage.getItem(B.ratelimit)),[]),b=n.useCallback(t=>{t.preventDefault();const r=t.target.elements.namedItem("token").value;localStorage.setItem(u.token,r),j(r)},[]),N=n.useCallback(()=>{V().then(t=>{localStorage.setItem(u.gistId,t.id),x(t.id)}).catch(t=>{g.pub({type:"warning",text:t.message})})},[]),I=n.useCallback(t=>{t.preventDefault();const r=t.target.elements.namedItem("gist-id").value;localStorage.setItem(u.gistId,r),x(r),H().catch(c=>{g.pub({type:"warning",text:c.message})})},[]);n.useEffect(()=>{l!==null||m===null||"HTMLDataListElement"in window&&K().then(t=>{v(t.filter(s=>s.description===R.description&&R.fileName in s.files).map(({id:s})=>s))}).catch(t=>{g.pub({type:"warning",text:t.message})})},[m,l]),n.useEffect(()=>{l!==null&&U().then(t=>{if(t===null)return;const s=Object.values(t.files).filter(a=>a.filename.endsWith(".lrc"));localStorage.setItem(u.gistFile,JSON.stringify(s,["filename","content","truncated","raw_url"])),O(s)}).catch(t=>{g.pub({type:"warning",text:t.message})})},[l]);const w=n.useCallback(t=>{const s=t.target;if(!("key"in s.dataset))return;const a=Number.parseInt(s.dataset.key,10),r=o==null?void 0:o[a];r&&(r.truncated?fetch(r.raw_url).then(async c=>c.text()).then(c=>{p({type:G.parse,payload:{text:c,options:h}})}).catch(c=>{g.pub({type:"warning",text:c.message})}):p({type:G.parse,payload:{text:r.content,options:h}}))},[o,p,h]),S=n.useCallback(()=>{x(null),j(null)},[]),y=n.useMemo(()=>{if(d===null)return!1;const t=new Intl.DateTimeFormat(k,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}).format(new Date(Number.parseInt(d["x-ratelimit-reset"],10)*1e3));return e.jsxs("section",{className:"ratelimit",children:[e.jsxs("p",{children:["ratelimit-limit: ",d["x-ratelimit-limit"]]}),e.jsxs("p",{children:["ratelimit-remaining: ",d["x-ratelimit-remaining"]]}),e.jsxs("p",{children:["ratelimit-reset: ",t]})]})},[d,k]),E=n.useCallback(()=>l!==null&&m!==null?e.jsxs("details",{className:"gist-details",children:[e.jsx("summary",{children:i.gist.info}),e.jsxs("section",{className:"gist-bar",children:[e.jsxs("section",{className:"gist-info",children:[e.jsxs("p",{children:["Gist id: ",e.jsx("a",{href:`https://gist.github.com/${l}`,target:"_blank",rel:"noopener noreferrer",className:"link",children:l})]}),e.jsx("button",{className:"button",onClick:S,children:i.gist.clearTokenAndGist})]}),y]})]}):null,[l,m,i.gist.info,i.gist.clearTokenAndGist,S,y]),A=n.useMemo(()=>{if(m===null)return e.jsxs("section",{className:"new-token",children:[e.jsx(C,{}),e.jsx("p",{className:"new-token-tip-text",children:i.gist.newTokenTip}),e.jsx("a",{className:"new-token-tip button",target:"_blank",rel:"noopener noreferrer",href:W,children:i.gist.newTokenButton}),e.jsxs("form",{className:"new-token-form",onSubmit:b,children:[e.jsx("label",{htmlFor:"github-token",children:"Token:"}),e.jsx("input",{type:"text",className:"new-token-input",id:"github-token",name:"token",minLength:40,maxLength:40,required:!0,...F},"token"),e.jsx("input",{className:"new-token-submit button",type:"submit"})]})]})},[m,i.gist.newTokenTip,i.gist.newTokenButton,b]),D=n.useMemo(()=>{if(l===null){const t=a=>e.jsx("option",{value:a},a),s=f&&e.jsxs("datalist",{id:"gist-list",children:[f.map(a=>t(a)),";"]});return e.jsxs("section",{className:"get-gist-id",children:[e.jsx(C,{}),e.jsx("p",{className:"gist-id-tip-text",children:i.gist.newGistTip}),e.jsx("button",{className:"create-new-gist button",onClick:N,children:i.gist.newGistRepoButton}),e.jsxs("form",{className:"gist-id-form",onSubmit:I,children:[e.jsx("label",{htmlFor:"gist-id",children:"Gist id:"}),e.jsx("input",{type:"text",className:"gist-id-input",id:"gist-id",name:"gist-id",list:"gist-list",placeholder:i.gist.gistIdPlaceholder,required:!0,...F},"gist-id"),e.jsx("input",{className:"button",type:"submit"}),s]})]})}},[l,f,i.gist.newGistTip,i.gist.newGistRepoButton,i.gist.gistIdPlaceholder,N,I]),M=n.useMemo(()=>{if(o!==null){const t=(s,a)=>e.jsxs("article",{className:"file-item",children:[e.jsx("section",{className:"file-content",children:s.content}),e.jsx("hr",{}),e.jsxs("section",{className:"file-bar",children:[e.jsx("span",{className:"file-title",children:s.filename}),e.jsxs("span",{className:"file-action",children:[e.jsx("a",{className:"file-load",href:T(L.editor),"data-key":a,children:e.jsx(z,{})}),e.jsx("a",{className:"file-load",href:T(L.synchronizer),"data-key":a,children:e.jsx(J,{})})]})]})]},s.raw_url);return o.length===0?e.jsx("section",{className:"gist-no-data",children:e.jsx(q,{})}):e.jsx("section",{className:"file-list",onClick:w,children:o.map(t)})}},[o,w]);return e.jsxs("div",{className:"gist",children:[e.jsx(E,{}),A||D||M||e.jsx($,{})]})},$=()=>e.jsx("section",{className:"gist-loading",children:e.jsx(P,{})});export{Y as Gist};
