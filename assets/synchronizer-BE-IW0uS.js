import{R as s,A as i,s as M,j as r,d as $,D as z,e as w,f as d,g as H,h as I,i as E,k as P,a as q,u as J,S as R,l as Q,m as W,I as p,n as X}from"./index-CggZzSzW.js";import{l as Y}from"./lrc-file-name-BlWFRsDa.js";const T=s.memo(({syncMode:n,setSyncMode:t,lrcDispatch:g,prefState:o})=>{const[c,k]=s.useState(),[u,h]=s.useState(),m=s.useCallback(()=>{t(x=>x===S.select?S.highlight:S.select)},[t]),y=s.useCallback(()=>{g({type:i.getState,payload:x=>{const j=M(x,o);k(f=>(f&&URL.revokeObjectURL(f),URL.createObjectURL(new Blob([j],{type:"text/plain;charset=UTF-8"})))),h(Y(x.info))}})},[g,o]),C=n===S.select?"select":"highlight",L=["aside-button","syncmode-button","ripple","glow ",C].join(w.space);return r.jsxs("aside",{className:"aside-panel",children:[r.jsx("button",{className:L,onClick:m,"aria-label":`${C} mode`,children:r.jsx($,{})}),r.jsx("a",{href:c,download:u,className:"aside-button ripple glow",onClick:y,children:r.jsx(z,{})})]})});T.displayName=T.name;const v=({fixed:n})=>{const t=s.useRef(Symbol(v.name)),[g,o]=s.useState(d.currentTime),[c,k]=s.useState(d.paused),[u,h]=s.useState(d.playbackRate);return s.useEffect(()=>H.sub(t.current,m=>{switch(m.type){case I.pause:{k(m.payload);break}case I.rateChange:{h(m.payload);break}}}),[]),s.useEffect(()=>{const m=[1,10,100,1e3][n]*u;if(c||2*m>60)return E.sub(t.current,y=>{o(y)});{const y=setInterval(()=>{o(d.currentTime)},1e3/(2*m));return()=>{clearInterval(y)}}},[n,c,u]),r.jsx("time",{className:"curser",children:P(g,n)})},Z=({sync:n})=>r.jsx("button",{className:"space-button",onClick:n,children:"space"});var S=(n=>(n[n.select=0]="select",n[n.highlight=1]="highlight",n))(S||{});const _=({state:n,dispatch:t})=>{const g=s.useRef(Symbol(_.name)),{selectIndex:o,currentIndex:c,lyric:k}=n,{prefState:u,lang:h}=s.useContext(q),m=J();s.useEffect(()=>{t({type:i.info,payload:{name:"tool",value:`${h.app.name} https://lrc-maker.github.io`}})},[t,h]);const[y,C]=s.useState(()=>sessionStorage.getItem(R.syncMode)==="1"?1:0);s.useEffect(()=>{sessionStorage.setItem(R.syncMode,y.toString())},[y]);const L=s.useRef(null),x={0:o,1:c}[y];s.useEffect(()=>{var e;const a=(e=L.current)==null?void 0:e.children[x];a!==void 0&&a.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},[x]),s.useEffect(()=>E.sub(g.current,a=>{t({type:i.refresh,payload:a})}),[t]);const j=s.useCallback(()=>{d.duration&&t({type:i.next,payload:d.currentTime})},[t]),f=s.useCallback((a,e,b)=>{var D;if(!d.duration)return;const l=(D=k[b])==null?void 0:D.time;l!==void 0&&t({type:i.time,payload:d.step(a,e,l)})},[t,k]);s.useEffect(()=>{function a(e){if(Q(e.target))return;switch(W(e,m)){case p.Sync:e.preventDefault(),j();break;case p.DeleteTime:e.preventDefault(),t({type:i.deleteTime,payload:void 0});break;case p.ResetOffset:e.preventDefault(),f(e,0,o);break;case p.DecreaseOffset:e.preventDefault(),f(e,-.5,o);break;case p.IncreaseOffset:e.preventDefault(),f(e,.5,o);break;case p.PrevLine:e.preventDefault(),t({type:i.select,payload:l=>l-1});break;case p.NextLine:e.preventDefault(),t({type:i.select,payload:l=>l+1});break;case p.FirstLine:e.preventDefault(),t({type:i.select,payload:()=>0});break;case p.LastLine:e.preventDefault(),t({type:i.select,payload:()=>1/0});break;case p.PageUp:e.preventDefault(),t({type:i.select,payload:l=>l-10});break;case p.PageDown:e.preventDefault(),t({type:i.select,payload:l=>l+10});break}}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[f,t,m,o,j]);const A=s.useCallback(a=>{a.stopPropagation();const e=a.target;if(e.classList.contains("line")){const b=Number.parseInt(e.dataset.key,10)||0;t({type:i.select,payload:()=>b})}},[t]),B=s.useCallback(a=>{if(a.stopPropagation(),!d.duration)return;const e=a.target;if(e.classList.contains("line")){const b=Number.parseInt(e.dataset.key,10);f(a,0,b)}},[f]),O=s.useCallback((a,e,b)=>{const l=e===o,D=e===c,K=e>0&&b[e].time<=b[e-1].time,F=Object.entries({line:!0,select:l,highlight:D,error:K}).reduce((N,[G,V])=>(V&&N.push(G),N),[]).join(w.space);return r.jsx(ee,{index:e,className:F,line:a,select:l,prefState:u},e)},[o,c,u]),U=u.screenButton?"lyric-list on-screen-button":"lyric-list";return r.jsxs(r.Fragment,{children:[r.jsx("ul",{ref:L,className:U,onClickCapture:A,onDoubleClickCapture:B,children:n.lyric.map(O)}),r.jsx(T,{syncMode:y,setSyncMode:C,lrcDispatch:t,prefState:u}),u.screenButton&&r.jsx(Z,{sync:j})]})},ee=({line:n,index:t,select:g,className:o,prefState:c})=>{const k=P(n.time,c.fixed),u=X(n.text,c.spaceStart,c.spaceEnd);return r.jsxs("li",{"data-key":t,className:o,children:[g&&r.jsx(v,{fixed:c.fixed}),r.jsx("time",{className:"line-time",children:k}),r.jsx("span",{className:"line-text",children:u})]},t)};export{S as SyncMode,_ as Synchronizer};
